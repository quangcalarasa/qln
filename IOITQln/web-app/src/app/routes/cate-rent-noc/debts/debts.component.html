<div>
  <div class="card-custom">
    <div class="card-header">
      <ng-container [ngTemplateOutlet]="nzExtra"></ng-container>
    </div>
  </div>

  <ng-template #nzExtra>
    <div nz-row>
      <div nz-col [nzSm]="24" [nzMd]="6">
        <h3 class="title-table">
          <i nz-icon nzType="arrow-left" nzTheme="outline" (click)="onBack()"></i>
          Tra cứu công nợ
        </h3>
      </div>
    </div>
    <div nz-row [nzGutter]="24">
      <!-- <div nz-col [nzSpan]="8">
        <nz-form-item>
          <nz-form-control>
            <nz-select
              nzAllowClear
              [(ngModel)]="query.type"
              [nzDropdownMatchSelectWidth]="false"
              name="type"
              id="type"
              [nzPlaceHolder]="'Mã định danh căn nhà'"
              [nzShowSearch]="true"
              (ngModelChange)="oneChangeBlock($event)"
            >
              <nz-option *ngFor="let i of block_data; let idx = index" [nzLabel]="i.Address" [nzValue]="i.Id"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col [nzSpan]="8" *ngIf="apartment_data && apartment_data.length > 0">
        <nz-form-item>
          <nz-form-control>
            <nz-select
              nzAllowClear
              [nzDropdownMatchSelectWidth]="false"
              [(ngModel)]="query.type"
              name="type"
              id="type"
              [nzPlaceHolder]="'Mã định danh hộ'"
              [nzShowSearch]="true"
              (ngModelChange)="oneChangeApartment($event)"
            >
              <nz-option *ngFor="let i of apartment_data; let idx = index" [nzLabel]="i.Code" [nzValue]="i.Id"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div> -->

      <div nz-col [nzSpan]="8">
        <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
          <input type="text"  [(ngModel)]="code" nz-input placeholder="Nhập mã định danh căn nhà(Căn hộ)" />
        </nz-input-group>
        <ng-template #suffixIconButton>
          <button nz-button  nzType="primary" (click)="onClick()" nzSearch><span nz-icon nzType="search"></span></button>
        </ng-template>
      </div>

      <!-- <div nz-col [nzSpan]="8">
        <button nz-button nzType="primary" nz-button (click)="SearchData()">Tra cứu</button>
      </div> -->
    </div>
  </ng-template>

  <nz-form nz-form [formGroup]="validateForm" style="padding-bottom: 30px">
    <div nz-row [nzGutter]="24">
      <div nz-col [nzSpan]="8">
        <nz-form-item>
          <nz-form-label [nzSpan]="24" nzFor="Code">Mã định danh</nz-form-label>
          <nz-form-control [nzSpan]="24">
            <input formControlName="Code" class="width-60" Disabled="true" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-item>
          <nz-form-label [nzSpan]="24" nzFor="CustomerName">Tên khách hàng</nz-form-label>
          <nz-form-control [nzSpan]="24">
            <input formControlName="CustomerName" class="width-60" Disabled="true" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-item>
          <nz-form-label [nzSpan]="24" nzFor="Phone">Số điện thoại</nz-form-label>
          <nz-form-control [nzSpan]="24">
            <input formControlName="Phone" class="width-60" Disabled="true" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="8">
        <nz-form-item>
          <nz-form-label [nzSpan]="24" nzFor="Address">Địa chỉ khách hàng</nz-form-label>
          <nz-form-control [nzSpan]="24">
            <input formControlName="Address" class="width-60" Disabled="true" />
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
  </nz-form>

  <div style="margin: 20px; float: right">
    <label *ngIf="isCheck == false" style="color: rgb(93, 219, 93); font-weight: bold; margin: 10px"
      >Số dư treo : {{ validateForm.value.SurplusBalance | number: '0.0-2':'de-DE' }} VNĐ</label
    >
    <label *ngIf="isCheck == true" style="color: rgb(93, 219, 93); font-weight: bold; margin: 10px"
      >Số dư treo : {{ this.SurplusBalance | number: '0.0-2':'de-DE' }} VNĐ</label
    >
    <button nz-button [nzType]="'primary'" (click)="Payment()">Phiếu thu</button>

    <button nz-button [nzType]="'primary'" (click)="Receipts()">Phiếu chi</button>
  </div>

  <div style="margin: 20px; float: left">
    <button nz-button [nzType]="'primary'" (click)="dowload()">Xuất biểu mẫu công nợ</button>
    <button nz-button [nzType]="'primary'" (click)="ImportDebt()">Thêm dữ liệu công nợ</button>
  </div>

  <div class="table-bct" style="margin-top: 75px">
    <ng-container *ngFor="let itemData of dataTable; let z = index">
      <h3 *ngIf="itemData.Type == 3">Hợp đồng {{ z + 1 }}</h3>
      <h3 *ngIf="itemData.Type == 1">Dữ liệu excel</h3>
      <h3 *ngIf="itemData.Type == 2">Phiếu truy thu</h3>
      <table>
        <thead>
          <th>Từ tháng</th>
          <th>Đến tháng</th>
          <th>Số tiền</th>
          <th>Đã nộp</th>
          <th>Người thực hiện</th>
          <th>Ngày thực hiện</th>
          <th>Hoạt động gần nhất</th>
          <th>Số tiền còn nợ</th>
          <th>Số tiền trước thuế</th>
          <th>Tiền VAT</th>
          <th>Đã nộp về sở</th>
        </thead>
        <tbody>
          <ng-container *ngFor="let item of itemData.groupDataDebtsByDates; let j = index">
            <ng-container *ngFor="let items of item.groupDebtTables; let i = index; let firstChild = first">
              <tr>
                <td *ngIf="firstChild" class="text-center">{{ item.DateStart | date: 'dd/MM/yyyy' }}</td>
                <td *ngIf="firstChild" class="text-center">{{ item.DateEnd | date: 'dd/MM/yyyy' }}</td>
                <td *ngIf="firstChild" style="text-align: right">{{ item.Price | number: '0.0-2':'de-DE' }}</td>
                <td *ngIf="firstChild && isCheck == false" class="text-center">
                  <input
                    *ngIf="item.Price <= validateForm.value.SurplusBalance || item.Check"
                    type="checkbox"
                    (click)="check(z, j, i)"
                    [checked]="item.Check"
                  />
                  <input *ngIf="item.Price > validateForm.value.SurplusBalance && !item.Check" disabled type="checkbox" />
                </td>
                <td *ngIf="firstChild && isCheck == true" class="text-center">
                  <input
                    *ngIf="item.Price <= this.SurplusBalance || item.Check"
                    type="checkbox"
                    (click)="check(z, j, i)"
                    [checked]="item.Check"
                  />
                  <input *ngIf="item.Price > this.SurplusBalance && !item.Check" disabled type="checkbox" />
                </td>
                <td *ngIf="firstChild" class="text-center">{{ item.Executor }}</td>
                <td *ngIf="firstChild" class="text-center">{{ item.Date | date: 'dd/MM/yyyy' }}</td>
                <td *ngIf="firstChild" class="text-center">{{ item.NearestActivities }}</td>
                <td *ngIf="firstChild" style="text-align: right">{{ item.PriceDiff | number: '0.0-2':'de-DE' }}</td>
                <td *ngIf="firstChild" style="text-align: right">{{ item.AmountExclude | number: '0.0-2':'de-DE' }}</td>
                <td *ngIf="firstChild" style="text-align: right">{{ item.VATPrice | number: '0.0-2':'de-DE' }}</td>
                <td *ngIf="firstChild" class="text-center">
                  <input
                    *ngIf="item.PriceDiff == 0"
                    type="checkbox"
                    (click)="CheckPayDepartment(z, j, i)"
                    [checked]="item.CheckPayDepartment"
                  />
                </td>
              </tr>
            </ng-container>
          </ng-container>
        </tbody>
      </table>
    </ng-container>
  </div>

  <div style="margin-top: 20px">
    <div>
      <label *ngIf="isCheck == false" style="font-weight: bold">Tổng : {{ validateForm.value.Total | number: '0.0-2':'de-DE' }}</label>
      <label *ngIf="isCheck == true" style="font-weight: bold">Tổng : {{ this.Total | number: '0.0-2':'de-DE' }}</label>
    </div>
    <div>
      <label *ngIf="isCheck == false" style="font-weight: bold">Dã nộp : {{ validateForm.value.Paid | number: '0.0-2':'de-DE' }} </label>
      <label *ngIf="isCheck == true" style="font-weight: bold">Dã nộp : {{ this.Paid | number: '0.0-2':'de-DE' }}</label>
    </div>
    <div>
      <label *ngIf="isCheck == false" style="font-weight: bold">Còn nợ : {{ validateForm.value.Diff | number: '0.0-2':'de-DE' }} </label>
      <label *ngIf="isCheck == true" style="font-weight: bold">Còn nợ : {{ this.Diff | number: '0.0-2':'de-DE' }}</label>
    </div>
  </div>
</div>

<div class="drawer-footer" style="position: relative !important">
  <button nz-button [nzType]="'primary'" (click)="submitForm()">
    <i nz-icon nzType="save" nzTheme="outline"></i>
    Lưu
  </button>
</div>
