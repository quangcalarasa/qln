<form nz-form [formGroup]="validateForm" (ngSubmit)="submitForm()" style="padding-bottom: 30px">
  <div nz-row [nzGutter]="24">
    <div nz-col [nzSpan]="12">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzFor="DecreeType1Id" nzRequired>Nghị định áp dụng cho biên bản</nz-form-label>
        <nz-form-control [nzSpan]="24" nzHasFeedback nzErrorTip="Chưa chọn Nghị định áp dụng cho biên bản!">
          <nz-select
            nzAllowClear
            formControlName="DecreeType1Id"
            name="DecreeType1Id"
            id="DecreeType1Id"
            nzPlaceHolder=""
            [nzShowSearch]="true"
          >
            <nz-option *ngFor="let i of decree_type1_data | keyvalue; let idx = index" [nzLabel]="i.value" [nzValue]="i.key"> </nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>
    <div nz-col [nzSpan]="12">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzFor="DecreeType2Id" nzRequired>Văn bản pháp luật liên quan</nz-form-label>
        <nz-form-control [nzSpan]="24" nzHasFeedback nzErrorTip="Chưa chọn Văn bản pháp luật liên quan!">
          <nz-select
            nzAllowClear
            formControlName="DecreeType2Id"
            name="DecreeType2Id"
            id="DecreeType2Id"
            nzPlaceHolder=""
            [nzShowSearch]="true"
          >
            <nz-option *ngFor="let i of decree_type2_data; let idx = index" [nzLabel]="i.Code" [nzValue]="i.Id"> </nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>
  <div nz-row [nzGutter]="24">
    <div nz-col [nzSpan]="12">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzFor="TypeReportApply" nzRequired>Loại biên bản áp dụng</nz-form-label>
        <nz-form-control [nzSpan]="24" nzHasFeedback nzErrorTip="Chưa chọn Loại biên bản áp dụng!">
          <nz-select
            nzAllowClear
            [compareWith]="compareFn"
            nzMode="multiple"
            formControlName="useValueCoefficientTypeReportApplies"
            nzPlaceHolder=""
            [nzShowSearch]="true"
          >
            <nz-option
              *ngFor="let i of TypeReportApply_data | keyvalue | filterTypeReportApplyWithoutAnyItem; let idx = index"
              [nzLabel]="i.value"
              [nzValue]="i"
            >
            </nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>
  <div nz-row [nzGutter]="24">
    <div nz-col [nzSpan]="24">
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzFor="Des">Căn cứ</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <textarea formControlName="Des" nz-input rows="2"></textarea>
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>
  <div nz-row class="row-title">
    <div nz-col [nzMd]="3">
      <span class="title">Bảng hệ số điều chỉnh</span>
    </div>
  </div>
  <div nz-row>
    <div nz-span>
      <a nz-button nzType="link" (click)="addRow()">
        <span nz-icon nzType="plus-circle"></span>
        Thêm hệ số điều chỉnh
      </a>
    </div>
  </div>
  <div nz-row [nzGutter]="24">
    <div nz-col [nzSpan]="24">
      <div class="card-body">
        <st
          #tableItemRef
          [data]="validateForm.value.useValueCoefficientItems"
          (change)="tableItemRefChange($event)"
          [columns]="columnsItem"
          [size]="'small'"
          [loading]="loading"
          [widthMode]="{ type: 'strict' }"
          [page]="{ front: false }"
        >
          <ng-template st-row="floorHeader" type="title"
            ><span class="danger-star danger-star-unleft">*</span>&nbsp;&nbsp;&nbsp;Tầng
          </ng-template>
          <ng-template st-row="valueHeader" type="title"
            ><span class="danger-star danger-star-unleft">*</span>&nbsp;&nbsp;&nbsp;Giá trị
          </ng-template>
          <ng-template st-row="noteHeader" type="title"
            ><span class="danger-star danger-star-unleft">*</span>&nbsp;&nbsp;&nbsp;Diễn giải
          </ng-template>
          <ng-template st-row="floorTpl" let-item let-index="index">
            <nz-select
              nzAllowClear
              [nzShowSearch]="true"
              class="width-sm"
              [ngClass]="item.submit && !item.FloorId ? 'danger-st-row' : ''"
              [ngModel]="item.FloorId"
              (ngModelChange)="tableItemRef.setRow(index, { FloorId: $event })"
              [ngModelOptions]="{ standalone: true }"
              [disabled]="!item.edit"
            >
              <nz-option *ngFor="let i of floor_data; let idx = index" [nzLabel]="i.Name" [nzValue]="i.Id"> </nz-option>
            </nz-select>
          </ng-template>
          <ng-template st-row="isMezzanineTpl" let-item let-index="index">
            <input
              nz-input
              [ngModel]="item.IsMezzanine"
              value="true"
              (ngModelChange)="tableItemRef.setRow(index, { IsMezzanine: $event })"
              [ngModelOptions]="{ standalone: true }"
              type="checkbox"
              [disabled]="!item.edit"
            />
          </ng-template>
          <ng-template st-row="valueTpl" let-item let-index="index">
            <input
              *ngIf="item.edit"
              type="text"
              currencyMask
              [options]="{ precision: 2 }"
              [options]="{ precision: 2 }"
              nz-input
              class="width-100 text-center"
              [ngModel]="item.Value"
              [ngClass]="item.submit && (!item.Value || item.Value == '') ? 'danger-st-row' : ''"
              (ngModelChange)="tableItemRef.setRow(index, { Value: $event })"
              [ngModelOptions]="{ standalone: true }"
            />
            <ng-container *ngIf="!item.edit">{{ item.Value | number: '0.0-2':'de-DE' }}</ng-container>
          </ng-template>
          <ng-template st-row="noteTpl" let-item let-index="index">
            <input
              *ngIf="item.edit"
              nz-input
              [ngClass]="item.submit && (!item.Note || item.Note == '') ? 'danger-st-row' : ''"
              [ngModel]="item.Note"
              (ngModelChange)="tableItemRef.setRow(index, { Note: $event })"
              [ngModelOptions]="{ standalone: true }"
            />
            <ng-container *ngIf="!item.edit">{{ item.Note }}</ng-container>
          </ng-template>
        </st>
      </div>
    </div>
  </div>
</form>

<div class="drawer-footer">
  <button nz-button [nzType]="'default'" (click)="close()">
    <i nz-icon nzType="stop" nzTheme="outline"></i>
    Đóng
  </button>
  <button nz-button [nzType]="'primary'" [disabled]="!validateForm.valid || invalid_tableItemRef || loading" (click)="submitForm()">
    <i nz-icon nzType="save" nzTheme="outline"></i>
    Lưu
  </button>
</div>
